# Open-LLM-VTuber Go + Vue 运行指南

## 项目结构

本项目包含两个主要部分：
- `go-backend/` - Go语言后端服务器
- `vue-frontend/` - Vue 3前端应用

## 环境要求

### Go 后端
- Go 1.21+
- Git

### Vue 前端
- Node.js 16+ 
- npm 或 yarn

## Go 后端部署和运行

### 1. 安装 Go 依赖

在 `go-backend/` 目录下执行：

```bash
cd go-backend
go mod tidy
```

这将安装所有必需的 Go 依赖包。

### 2. 配置环境变量（可选）

您可以创建 `.env` 文件或使用环境变量配置：

```bash
export HOST=localhost
export PORT=8080
export DEBUG=true
```

或者在 `config.yaml` 中配置（需要手动创建配置文件）：

```yaml
host: "localhost"
port: "8080"
debug: true
llm:
  provider: "ollama"
  model: "qwen2.5:latest"
  base_url: "http://localhost:11434/v1"
  api_key: "ollama"
asr:
  provider: "sherpa_onnx"
  model: "sense_voice"
tts:
  provider: "edge_tts"
  voice: "zh-CN-XiaoxiaoNeural"
system:
  max_connections: 1000
  buffer_size: 1024
```

### 3. 运行 Go 服务器

#### 方法一：直接运行
```bash
cd go-backend
go run cmd/server/main.go
```

#### 方法二：构建后运行
```bash
cd go-backend
go build -o bin/server cmd/server/main.go
./bin/server
```

服务器默认将在 `http://localhost:8080` 启动。

## Vue 前端部署和运行

### 1. 安装 Node.js 依赖

在 `vue-frontend/` 目录下执行：

```bash
cd vue-frontend
npm install
```

### 2. 配置前端环境（可选）

创建 `.env` 文件以配置前端环境变量：

```bash
# .env
VITE_API_BASE_URL=http://localhost:8080
VITE_WS_URL=ws://localhost:8080
VITE_PORT=3000
```

### 3. 运行开发服务器

```bash
cd vue-frontend
npm run dev
```

前端开发服务器将在 `http://localhost:3000` 启动，并通过代理将 `/api` 请求转发到 Go 后端的 `http://localhost:8080`。

### 4. 构建生产版本

```bash
cd vue-frontend
npm run build
```

构建后的文件将位于 `dist/` 目录中。

## Docker 部署（推荐）

### 构建和运行 Docker 容器

#### Go 后端 Docker 部署

1. 在 `go-backend/` 目录下创建 Dockerfile：

```dockerfile
FROM golang:1.21-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o main cmd/server/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/main .
EXPOSE 8080
CMD ["./main"]
```

2. 构建并运行 Go 后端容器：

```bash
cd go-backend
docker build -t go-backend .
docker run -p 8080:8080 go-backend
```

#### Vue 前端 Docker 部署

1. 在 `vue-frontend/` 目录下创建 Dockerfile：

```dockerfile
FROM node:18-alpine AS build

WORKDIR /app
COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

2. 创建 `nginx.conf` 文件：

```nginx
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    server {
        listen       80;
        server_name  localhost;

        location / {
            root   /usr/share/nginx/html;
            index  index.html;
            try_files $uri $uri/ /index.html;
        }

        location /api {
            proxy_pass http://go-backend:8080;
        }

        location /ws {
            proxy_pass http://go-backend:8080;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
        }
    }
}
```

3. 构建并运行 Vue 前端容器：

```bash
cd vue-frontend
docker build -t vue-frontend .
docker run -p 3000:80 vue-frontend
```

#### 使用 Docker Compose 一键部署

1. 在项目根目录创建 `docker-compose.yml`：

```yaml
version: '3.8'

services:
  backend:
    build:
      context: ./go-backend
    ports:
      - "8080:8080"
    environment:
      - HOST=0.0.0.0
      - PORT=8080
    restart: unless-stopped

  frontend:
    build:
      context: ./vue-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
```

2. 运行整个应用：

```bash
docker-compose up -d
```

应用将在 `http://localhost` 可访问。

## 配置说明

### Go 后端配置

Go 后端支持以下配置项：

- `host`: 服务器主机地址（默认: localhost）
- `port`: 服务器端口（默认: 8080）
- `debug`: 是否开启调试模式（默认: false）
- `llm`: LLM服务配置
  - `provider`: LLM提供商（如: openai, ollama, claude等）
  - `model`: 使用的模型名称
  - `base_url`: API基础URL
  - `api_key`: API密钥
- `asr`: ASR服务配置
  - `provider`: ASR提供商
  - `model`: 使用的模型
- `tts`: TTS服务配置
  - `provider`: TTS提供商
  - `voice`: 使用的声音
- `system`: 系统配置
  - `max_connections`: 最大连接数
  - `buffer_size`: 缓冲区大小

### Vue 前端配置

Vue 前端支持以下环境变量：

- `VITE_API_BASE_URL`: 后端API基础URL
- `VITE_WS_URL`: WebSocket连接URL
- `VITE_PORT`: 前端服务器端口

## 开发模式

### 前后端联调开发

1. 启动 Go 后端：
```bash
cd go-backend
go run cmd/server/main.go
```

2. 启动 Vue 前端：
```bash
cd vue-frontend
npm run dev
```

3. 访问 `http://localhost:3000` 进行开发

### 热重载

- Go 后端: 需要手动重启
- Vue 前端: 支持热重载，修改代码后自动刷新

## 常见问题及解决方案

### 1. 端口被占用
- 检查端口使用情况：`netstat -an | grep :8080` (Windows) 或 `lsof -i :8080` (Mac/Linux)
- 修改配置文件中的端口设置

### 2. 前后端通信失败
- 确认 Go 后端已启动
- 检查前端代理配置
- 查看浏览器控制台是否有 CORS 错误

### 3. 依赖包安装失败
- Go: 检查 GOPROXY 设置
- Vue: 清除 npm 缓存：`npm cache clean --force`

### 4. Docker 构建失败
- 确保 Docker 服务已启动
- 检查 Dockerfile 语法
- 尝试增加构建资源限制

## 生产部署建议

1. 使用 Docker Compose 或 Kubernetes 进行容器化部署
2. 配置反向代理（如 Nginx）处理 HTTPS
3. 设置适当的资源限制和监控
4. 使用外部数据库存储会话和历史记录
5. 配置日志收集和错误监控